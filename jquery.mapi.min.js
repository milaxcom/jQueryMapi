/* jQueryMapi v1.0 */
var mapi=function(a){if("string"==typeof a)return mapi.findInit(a),a;mapi.storage=[];(a=$("meta[name='mapi:storage-url']").attr("content"))&&$.ajax({data:{request:"*"},url:a,dataType:"JSON",success:function(a){mapi.storage=a;mapi.autoInit()}})};mapi.ready=function(a){var b={yandex:"undefined"==typeof ymaps.Map?!1:!0,google:"undefined"==typeof google.maps.Map?!1:!0,dblgis:"undefined"==typeof DG.map?!1:!0};return"undefined"!=typeof a?b[a]:b};
mapi.autoInit=function(a){if("undefined"!=typeof a){for(var b in mapi.storage)mapi.storage[b].provider==a&&"undefined"==typeof mapi.storage[b].done&&($element=$("#"+mapi.storage[b].id),$element.length&&$element.hasClass("mapi")&&mapi.init(mapi.storage[b]));return a}refresh=!1;ready=mapi.ready();"undefined"==typeof mapi.uniqueProviderList&&mapi.uniqueProvider();for(b in mapi.uniqueProviderList)mapi.uniqueProviderList[b]||(ready[b]?(mapi.autoInit(b),mapi.uniqueProviderList[b]=!0):refresh=!0);refresh&&
setTimeout(mapi.autoInit,300)};mapi.uniqueProvider=function(){var a={},b;for(b in mapi.storage)"undefined"==typeof a[mapi.storage[b].provider]&&(a[mapi.storage[b].provider]=!1);mapi.uniqueProviderList=a};mapi.init=function(a){var b=$("#"+a.id);if(1!=b.length)return!1;var c=mapi[a.provider](a);mapi[a.provider].addBalloons.call(c,a);a.done=!0;b.addClass("mapi-ready")};mapi.findInit=function(a){for(var b in mapi.storage)mapi.storage[b].id==a&&mapi.ready(mapi.storage[b].provider)&&mapi.init(mapi.storage[b])};
mapi.yandex=function(a){return new ymaps.Map(a.id,{center:a.center,zoom:a.zoom[0],behaviors:["drag"],controls:["fullscreenControl","typeSelector"]},{maxZoom:a.zoom[1],minZoom:a.zoom[2]})};mapi.yandex.addBalloons=function(a){var b=[],c="",d;for(d in a.places)c=mapi.balloonContentBuild(a.places[d].content),b[d]=new ymaps.Placemark(a.places[d].position,{balloonContentBody:c}),this.geoObjects.add(b[d]);return b};
mapi.google=function(a){var b={center:mapi.google.pos2latlng(a.center),zoom:a.zoom[0],maxZoom:a.zoom[1],minZoom:a.zoom[2],disableDoubleClickZoom:!0,disableDefaultUI:!0,mapTypeControl:!0,scrollwheel:!1};return new google.maps.Map(document.getElementById(a.id),b)};
mapi.google.addBalloons=function(a){var b=[],c=[],d="",e;for(e in a.places)d=mapi.balloonContentBuild(a.places[e].content),c[e]=new google.maps.InfoWindow({content:d}),b[e]=new google.maps.Marker({position:mapi.google.pos2latlng(a.places[e].position),map:this}),b[e].infowindow=c[e],google.maps.event.addListener(b[e],"click",mapi.google.openinfo);return b};mapi.google.pos2latlng=function(a){return new google.maps.LatLng(a[0],a[1])};mapi.google.openinfo=function(){this.infowindow.open(this.map,this)};
mapi.dblgis=function(a){return DG.map(a.id,{center:a.center,zoom:a.zoom[0],maxZoom:a.zoom[1],minZoom:a.zoom[2],doubleClickZoom:!1,zoomControl:!1,scrollWheelZoom:!1})};mapi.dblgis.addBalloons=function(a){var b=[],c="",d;for(d in a.places)c=mapi.balloonContentBuild(a.places[d].content),b[d]=DG.marker(a.places[d].position).bindPopup(c),b[d].addTo(this);return b};mapi.balloonContentBuild=function(a){var b="",c;for(c in a)"undefined"!=typeof a[c]&&(b+='<div class="mapi-'+c+'">'+a[c]+"</div>");return b};
$(mapi);(function(a){a.fn.mapi=function(){var b=a(this).attr("id");if("undefined"==typeof b)return!1;mapi.findInit(b)}})(jQuery);